{
  "version": 3,
  "sources": ["../../../../../../app/routes/banner/activities/$location/index.jsx"],
  "sourcesContent": ["import { useLoaderData } from \"@remix-run/react\";\nimport Custom404Page from \"~/routes/$\";\nimport { getDirectusClient } from \"~/lib/directus\";\nimport { sessionStorage } from \"~/services/session.server\";\nimport { json } from \"@remix-run/node\";\nimport { format,addHours } from \"date-fns\";\n//import { getAssetURL } from \"~/utils/get-asset-url\";\nimport marienlystLogo from \"~/assets/images/marienlyst_logo.svg\"\n\nexport const loader = async ({ request, params }) => {\n  // Fetching session from the cookie\n  const session = await sessionStorage.getSession(\n    request.headers.get(\"Cookie\")\n  );\n\n  // Connecting with directus client using session key\n  var sessionkey = session.get(\"sessionKey\");\n  const directus = await getDirectusClient(sessionkey);\n  const current = await directus.users.me.read({\n    fields: [\"*\", \"selected_locations.*.*.*\", \"allowed_locations.*.*.*\"],\n  });\n\n  // Don't forget to change the static date, time !\n  const todaydate = addHours(new Date(),1); //\"2024-01-13 16:02:00\"\n\n  // Formatting date and time for query filter\n  const today_time = format(todaydate, \"HH:mm':00'\");\n  const date_filter = format(todaydate, \"yyyy-MM-dd\");\n\n  // Checking today is in the allowed days\n  const day_name = format(todaydate, \"EEEE\");\n  const allowed_days = [\"Friday\", \"Saturday\", \"Sunday\"];\n  const is_allowed_day = allowed_days?.some((day) => day == day_name);\n\n  // Fetching logo and current location\n  const locationId = params?.location;\n  const logo = current?.selected_locations?.logo?.id;\n\n  // Fetching the activites by today date, time and current location then sorting it by time.\n  const response = await directus.items(\"activities\").readByQuery({\n    fields: [\"*\"],\n    filter: {\n      date: { _eq: date_filter },\n      time: { _gte: today_time },\n      location_id: { _eq: locationId },\n    },\n    sort: [\"time\"],\n    limit: 8,\n  });\n  // Checking location id in the url param exists\n  const Locations = await directus\n    .items(\"Locations\")\n    .readByQuery({ fields: [\"id\"] });\n  const LocationMatch = Locations?.data?.some((e) => e?.id == locationId);\n\n  return json({\n    logo: logo,\n    data: response.data,\n    today: day_name,\n    today_date: date_filter,\n    location: LocationMatch,\n    is_allowed_day,\n  });\n};\n\nfunction RenderActivityTimeLine(props) {\n  const activity_track = [];\n\n  // Rendering the activities timeline.\n  props?.activities?.map((activity) => {\n    activity?.activity_name && activity?.time\n      ? activity_track.push(\n          <li className=\"pb-[50px] ms-4\" key={activity?.id}>\n            <div className=\"relative\">\n              <p className=\"absolute -ml-[125px] mb-1 text-sm font-normal leading-none activity_time\">\n                {format(\n                  new Date(props?.today_date + \"T\" + activity?.time),\n                  \"h:mm a\"\n                )}\n              </p>\n              <div className=\"absolute w-[15px] h-[15px] bg-primary rounded-full border-primary circle-icon\"></div>\n              <div className=\"activities_list\">\n                <h3 className=\"pl-5 font-normal activity_name\">\n                  {activity?.activity_name}\n                </h3>\n                <p className=\"pl-5 activity_description\">\n                  {activity?.activity_description}\n                </p>\n              </div>\n            </div>\n          </li>\n        )\n      : \"\";\n  });\n\n  return (\n    <>\n      <div className=\"activity_track w-full pl-[150px] max-w-[834px] pt-[40px]\">\n        <ol className=\"relative border-s border-primary w-full font-futura\">\n          {activity_track}\n        </ol>\n      </div>\n    </>\n  );\n}\n\nexport default function index() {\n  const { logo, today, data, is_allowed_day, location, today_date } =\n    useLoaderData();\n\n  return (\n    <>\n      {is_allowed_day && location ? (\n        <div className=\"activity-preview room-banner flex flex-col text-primary items-center justify-start min-h-[100vh] px-6 py-32 mx-auto bg-[#ebdbb4]\">\n          {data?.length != 0 ? (\n            <>\n              <img\n                className=\"my-[72px] min-w-[175px]\"\n                alt=\"company logo\"\n                src={marienlystLogo} //{getAssetURL(logo)}\n              />\n              <h1 className=\"pb-[25px] font-ivymode title\">What's on</h1>\n              <p className=\"pb-[50px] font-ivymode date\">{today}</p>\n              {data.length != 0 ? (\n                <RenderActivityTimeLine\n                  activities={data}\n                  today_date={today_date}\n                />\n              ) : (\n                <p className=\"text-xl mt-10\">No activites for the day.</p>\n              )}\n            </>\n          ) : (\n            \"\"\n          )}\n        </div>\n      ) : (\n        <Custom404Page />\n      )}\n    </>\n  );\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAGA,qBAA+B;AAH/B;AAiEA,SAAS,uBAAuB,OAAO;AAjEvC;AAkEE,QAAM,iBAAiB,CAAC;AAGxB,uCAAO,eAAP,mBAAmB,IAAI,CAAC,aAAa;AACnC,0CAAU,mBAAiB,qCAAU,QACjC,eAAe;AAAA,MACb,mDAAC;AAAA,QAAG,WAAU;AAAA,QACZ,6DAAC;AAAA,UAAI,WAAU;AAAA,UACb;AAAA,+DAAC;AAAA,cAAE,WAAU;AAAA,cACV;AAAA,gBACC,IAAI,MAAK,+BAAO,cAAa,OAAM,qCAAU,KAAI;AAAA,gBACjD;AAAA,cACF;AAAA,eAJF;AAAA;AAAA;AAAA;AAAA,mBAKA;AAAA,YACA,mDAAC;AAAA,cAAI,WAAU;AAAA,eAAf;AAAA;AAAA;AAAA;AAAA,mBAA+F;AAAA,YAC/F,mDAAC;AAAA,cAAI,WAAU;AAAA,cACb;AAAA,mEAAC;AAAA,kBAAG,WAAU;AAAA,kBACX,+CAAU;AAAA,mBADb;AAAA;AAAA;AAAA;AAAA,uBAEA;AAAA,gBACA,mDAAC;AAAA,kBAAE,WAAU;AAAA,kBACV,+CAAU;AAAA,mBADb;AAAA;AAAA;AAAA;AAAA,uBAEA;AAAA;AAAA,eANF;AAAA;AAAA;AAAA;AAAA,mBAOA;AAAA;AAAA,WAfF;AAAA;AAAA;AAAA;AAAA,eAgBA;AAAA,SAjBkC,qCAAU,IAA9C;AAAA;AAAA;AAAA;AAAA,aAkBA;AAAA,IACF,IACA;AAAA,EACN;AAEA,SACE;AAAA,IACE,6DAAC;AAAA,MAAI,WAAU;AAAA,MACb,6DAAC;AAAA,QAAG,WAAU;AAAA,QACX;AAAA,SADH;AAAA;AAAA;AAAA;AAAA,aAEA;AAAA,OAHF;AAAA;AAAA;AAAA;AAAA,WAIA;AAAA,KALF;AAAA;AAAA;AAAA;AAAA,SAMA;AAEJ;AAEe,SAAR,QAAyB;AAC9B,QAAM,EAAE,MAAM,OAAO,MAAM,gBAAgB,UAAU,WAAW,IAC9D,cAAc;AAEhB,SACE;AAAA,IACG,4BAAkB,WACjB,mDAAC;AAAA,MAAI,WAAU;AAAA,MACZ,wCAAM,WAAU,IACf;AAAA,QACE;AAAA,6DAAC;AAAA,YACC,WAAU;AAAA,YACV,KAAI;AAAA,YACJ,KAAK;AAAA,aAHP;AAAA;AAAA;AAAA;AAAA,iBAIA;AAAA,UACA,mDAAC;AAAA,YAAG,WAAU;AAAA,YAA+B;AAAA,aAA7C;AAAA;AAAA;AAAA;AAAA,iBAAsD;AAAA,UACtD,mDAAC;AAAA,YAAE,WAAU;AAAA,YAA+B;AAAA,aAA5C;AAAA;AAAA;AAAA;AAAA,iBAAkD;AAAA,UACjD,KAAK,UAAU,IACd,mDAAC;AAAA,YACC,YAAY;AAAA,YACZ;AAAA,aAFF;AAAA;AAAA;AAAA;AAAA,iBAGA,IAEA,mDAAC;AAAA,YAAE,WAAU;AAAA,YAAgB;AAAA,aAA7B;AAAA;AAAA;AAAA;AAAA,iBAAsD;AAAA;AAAA,SAd1D;AAAA;AAAA;AAAA;AAAA,aAgBA,IAEA;AAAA,OApBJ;AAAA;AAAA;AAAA;AAAA,WAsBA,IAEA,mDAAC,mBAAD;AAAA;AAAA;AAAA;AAAA,WAAe;AAAA,KA1BnB;AAAA;AAAA;AAAA;AAAA,SA4BA;AAEJ;",
  "names": []
}
