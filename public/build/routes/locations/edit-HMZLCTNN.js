import{a as Xt}from"/build/_shared/chunk-WUGKZFRL.js";import{a as St}from"/build/_shared/chunk-5RL4YNCK.js";import{a as Zt}from"/build/_shared/chunk-QPJOCY54.js";import{b as kt}from"/build/_shared/chunk-USL65MEA.js";import{c as Jt,d as It}from"/build/_shared/chunk-RGLHNRFR.js";import"/build/_shared/chunk-7R5B3IJR.js";import"/build/_shared/chunk-VQXNYB6I.js";import{b,c as Nt}from"/build/_shared/chunk-YCQR2KKZ.js";import{B as xt,h as gt,o as ht,p as _t,q as yt,s as wt,t as bt,u as vt}from"/build/_shared/chunk-74WNBD7U.js";import{a as Yt}from"/build/_shared/chunk-46CN3765.js";import{a as dt,b as ct,i as ut,j as ft}from"/build/_shared/chunk-62BE6IG2.js";import{a as zt,b as pt}from"/build/_shared/chunk-TYFUAS6F.js";import{d as C}from"/build/_shared/chunk-W6WK5VNR.js";var v=C(zt());var Ct=C(Zt()),Vt=C(Yt()),de=C(Xt()),Lt=C(Jt()),t=C(pt());function te(){return{title:"Edit Location"}}function qt(){var T,U,A,P,G,W,K,$,z;let{data:r,uId:w,getAllStations:M,response:ee,location_id:Dt}=ft(),[Ot,Mt]=(0,v.useState)(!1),[E,R]=v.default.useState(!1),[jt,F]=(0,v.useState)(!1),[x,Bt]=v.default.useState((T=r[0])==null?void 0:T.name),[I,Et]=v.default.useState((A=(U=r[0])==null?void 0:U.logo)==null?void 0:A.id),[O,Rt]=v.default.useState((P=r[0])==null?void 0:P.screen_ids),[u,ae]=v.default.useState((G=r[0])==null?void 0:G.allowed_stations),_=gt,L=ct(),q=dt(),Ft={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",minWidth:"300px"}},Ht=async e=>{let o=new FormData;return o.append("folder",e),await _.files.createOne(o).then(s=>s==null?void 0:s.id).catch(s=>{console.log("Image create error",s==null?void 0:s.message)})},Qt=async e=>{await _.items("Stations").readByQuery({fields:["station_name_translation"],filter:{station_unique_id:{_eq:e==null?void 0:e.uniqueId}}}).then(async o=>{var s,d,m,a,p,h;let i=(m=(d=(s=o==null?void 0:o.data)==null?void 0:s[0])==null?void 0:d.station_name_translation)!=null&&m.length?(h=(p=(a=o==null?void 0:o.data)==null?void 0:a[0])==null?void 0:p.station_name_translation)==null?void 0:h.filter(c=>(c==null?void 0:c.location_id)!=w):[];await _.items("Stations").updateOne(e==null?void 0:e.stationId,{station_name_translation:i})}).catch(o=>console.log(o))},Tt=async()=>{var s,d,m;let e=(d=(s=r[0])==null?void 0:s.allowed_stations)==null?void 0:d.map(a=>a==null?void 0:a.Stations_id),o=u==null?void 0:u.map(a=>a==null?void 0:a.value),i=e==null?void 0:e.filter(a=>!(o!=null&&o.some(p=>(p==null?void 0:p.id)===(a==null?void 0:a.id))));((m=u==null?void 0:u.map(a=>a==null?void 0:a.value))==null?void 0:m.length)>0?i==null||i.map(async(a,p)=>{var h,c;if(((h=a==null?void 0:a.child_list)==null?void 0:h.length)>1){let n=((c=a==null?void 0:a.child_list)==null?void 0:c.length)===3?[ht,_t,yt]:[wt,bt,vt];n==null||n.map(async l=>{await _.items("screen_display").readByQuery({fields:["id"],filter:{location_id:{id:{_eq:w}},station_name:{station_unique_id:{_eq:l}}}}).then(async g=>{var N;await _.items("screen_display").deleteMany((N=g==null?void 0:g.data)==null?void 0:N.map(y=>y==null?void 0:y.id)).then(y=>{}).catch(y=>console.log(y))})})}await Qt({uniqueId:a==null?void 0:a.station_unique_id,stationId:a==null?void 0:a.id}),await _.items("screen_display").readByQuery({fields:["id"],filter:{location_id:{id:{_eq:w}},station_name:{station_unique_id:{_eq:a==null?void 0:a.station_unique_id}}}}).then(async n=>{var l;await _.items("screen_display").deleteMany((l=n==null?void 0:n.data)==null?void 0:l.map(g=>g==null?void 0:g.id)).then(g=>{}).catch(g=>console.log(g))}),p+1===(i==null?void 0:i.length)&&await H()}):b.error("Please select a station from the allowed stations field to continue")},Ut=async e=>{var o,i,s,d,m;if(((o=x==null?void 0:x.trim())==null?void 0:o.length)>0){R(!0);let a=(i=u[0])!=null&&i.value?u==null?void 0:u.map(c=>c==null?void 0:c.value):u,p=(d=(s=r[0])==null?void 0:s.allowed_stations)==null?void 0:d.map(c=>c==null?void 0:c.Stations_id),h=p==null?void 0:p.filter(c=>!(a!=null&&a.some(n=>(n==null?void 0:n.id)===(c==null?void 0:c.id))));(h==null?void 0:h.length)>0&&((m=r[0])==null?void 0:m.allowed_stations)!==a?F(!0):await H()}else b.error("Name is required")},H=async e=>{var s,d,m,a,p,h,c,n,l,g,N,y,J,X,Y,Z,V,tt,et,at,ot,nt,st,it,lt,rt,mt;let o=(s=u[0])!=null&&s.value?u==null?void 0:u.map(k=>k==null?void 0:k.value):u;if(o){let k=I!==((m=(d=r[0])==null?void 0:d.logo)==null?void 0:m.id)?await Ht(I):!0;var i=((a=r[0])==null?void 0:a.allowed_stations)===o;if(i===!1&&(await At(w),i=!0),k){if(i){let Kt=await _.items("Locations_Stations").readByQuery({fields:["id","*.*.*.*"],filter:{Locations_id:{id:{_eq:w}}}}).then(f=>{var D;return(D=f==null?void 0:f.data)==null?void 0:D.map(B=>B==null?void 0:B.id)}),$t=((p=r[0])==null?void 0:p.allowed_stations)===o?{name:x!==((h=r[0])==null?void 0:h.name)?x:(c=r[0])==null?void 0:c.name,logo:I!==((l=(n=r[0])==null?void 0:n.logo)==null?void 0:l.id)?k:(N=(g=r[0])==null?void 0:g.logo)==null?void 0:N.id,screen_ids:O!==((y=r[0])==null?void 0:y.screen_ids)?O:(J=r[0])==null?void 0:J.screen_ids,allowed_stations:(Y=(X=r[0])==null?void 0:X.allowed_stations)==null?void 0:Y.map(f=>f==null?void 0:f.id)}:{name:x!==((Z=r[0])==null?void 0:Z.name)?x:(V=r[0])==null?void 0:V.name,logo:I!==((et=(tt=r[0])==null?void 0:tt.logo)==null?void 0:et.id)?k:(ot=(at=r[0])==null?void 0:at.logo)==null?void 0:ot.id,screen_ids:O!==((nt=r[0])==null?void 0:nt.screen_ids)?O:(st=r[0])==null?void 0:st.screen_ids,allowed_stations:await Kt};await _.items("Locations").updateOne(w,$t).then(f=>{b.success("Updated successfully"),L("/")}).catch(f=>{L(".",{replace:!0}),b.error("Something went wrong")});let j=(lt=(it=r[0])==null?void 0:it.allowed_stations)==null?void 0:lt.map(f=>f==null?void 0:f.Stations_id),S=o==null?void 0:o.filter(f=>!(j!=null&&j.some(D=>(D==null?void 0:D.id)===(f==null?void 0:f.id))));if(S!=null&&S.length)for(let f=0;f<(S==null?void 0:S.length);f++)await((mt=_.items("screen_display"))==null?void 0:mt.createOne({menu_info:"",menu_info_1:"",location_id:{id:w},station_name:(rt=S[f])==null?void 0:rt.id,date:new Date}))}}else b.error("Something went wrong")}else b.error("Please select a station from the allowed stations field to continue")},At=async e=>{var m,a,p,h,c;let o=(m=u[0])!=null&&m.value?u==null?void 0:u.map(n=>n==null?void 0:n.value):u,i=(p=(a=r[0])==null?void 0:a.allowed_stations)==null?void 0:p.map(n=>n==null?void 0:n.Stations_id),s=o==null?void 0:o.filter(n=>!(i!=null&&i.some(l=>(l==null?void 0:l.id)===(n==null?void 0:n.id)))),d=i==null?void 0:i.filter(n=>!(o!=null&&o.some(l=>(l==null?void 0:l.id)===(n==null?void 0:n.id))));for(let n=0;n<(s==null?void 0:s.length);n++)await _.items("Locations_Stations").createOne({Locations_id:e,Stations_id:Number((h=s[n])==null?void 0:h.id)}).then(async l=>l==null?void 0:l.id).catch(l=>{console.log(l==null?void 0:l.message),L(".",{replace:!0}),b.error(l==null?void 0:l.message)});if(d!=null&&d.length)for(let n=0;n<(d==null?void 0:d.length);n++){let l=await _.items("Locations_Stations").readByQuery({fields:["id"],filter:{Locations_id:{id:{_eq:w}},Stations_id:{_eq:(c=d[n])==null?void 0:c.id}}}).then(g=>{var N;return(N=g==null?void 0:g.data)==null?void 0:N.map(y=>y==null?void 0:y.id)});await _.items("Locations_Stations").deleteOne(l)}return""},Pt=async()=>{await _.items("Locations").deleteOne(w).then(e=>{L("/locations/manage"),b.success("Deleted successfully")}).catch(e=>{console.log("catch error",e),b.error("Something went wrong")})},Gt=e=>{fetch(e,{method:"GET",headers:{}}).then(o=>{o.arrayBuffer().then(function(i){let s=(q==null?void 0:q.pathname)+(q==null?void 0:q.search),d=window.URL.createObjectURL(new Blob([i])),m=document.createElement("a");m.href=d,m.setAttribute("download","image.png"),document.body.appendChild(m),m.click(),L(s)})}).catch(o=>{console.log(o)})},Q=()=>{R(!1),F(!1)},Wt=[];return M==null||M.map(e=>{var o,i,s,d;return Wt.push(e!=null&&e.station_name_translation?{station_name:(i=(o=e==null?void 0:e.station_name_translation.filter(m=>(m==null?void 0:m.location_id)==w))==null?void 0:o[0])!=null&&i.name?(d=(s=e==null?void 0:e.station_name_translation.filter(m=>(m==null?void 0:m.location_id)==w))==null?void 0:s[0])==null?void 0:d.name:e==null?void 0:e.station_name,value:e}:{station_name:e==null?void 0:e.station_name,value:e})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(It,{title:!0,logout:!0,noLeftLogo:!!((W=xt)!=null&&W.includes(Dt))}),(0,t.jsx)("div",{className:"main-content-area",children:(0,t.jsx)("div",{className:"page__wrap w-full flex justify-center items-center max-h-[100vh] h-[100vh] min-h-[100vh]",children:(0,t.jsx)("div",{className:"border p-6 rounded-md border-gray-300 form-area",children:(0,t.jsxs)("div",{className:"max-w-[400px] w-full px-5",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center gap-5",children:[(0,t.jsxs)("div",{className:"flex justify-start items-center gap-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)("button",{type:"button",title:"Backward",onClick:()=>L("/"),className:"w-10 h-10 min-h-[40px] min-w-[40px] inline-flex items-center justify-center rounded-full border border-gray-100 bg-white  text-sm font-medium text-primary shadow-md hover:bg-gray-50 focus:outline-none focus:shadow-md sm:w-auto",children:(0,t.jsx)("span",{children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"3",stroke:"currentColor",className:"w-5 h-5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})})})}),(0,t.jsx)("div",{children:(0,t.jsx)("h1",{className:"text-xl font-semibold text-primary",children:(K=r[0])==null?void 0:K.name})})]}),(0,t.jsx)("div",{className:"flex justify-between items-center gap-5",children:(0,t.jsx)("button",{title:"Update Location",type:"button",onClick:e=>E?null:Ut(e),disabled:E,className:"w-10 h-10 min-w-[40px] min-h-[40px] inline-flex items-center justify-center rounded-full border border-transparent bg-primary text-sm font-medium text-white shadow-sm hover:bg-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 sm:w-auto",children:(0,t.jsx)("span",{children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-5 h-5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})})})]}),(0,t.jsx)("div",{className:"mt-6 block",children:(0,t.jsx)(ut,{children:(0,t.jsx)("div",{className:"space-y-6 bg-white py-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-6 gap-6",children:[(0,t.jsxs)("div",{className:"col-span-6",children:[(0,t.jsxs)("label",{htmlFor:"user-name",className:"block text-sm font-medium text-gray-700",children:["Name",(0,t.jsx)("span",{className:"text-red-600 text-base",children:"*"})]}),(0,t.jsx)("input",{type:"text",name:"user-name",id:"user-name",placeholder:"User Name",required:!0,value:x,onChange:e=>Bt(e.target.value),autoComplete:"given-name",className:"mt-1 block w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm placeholder:text-gray-400 placeholder:!text-sm placeholder:font-medium focus:border-primary  focus:outline-none focus:ring-primary sm:text-sm"})]}),(0,t.jsxs)("div",{className:"col-span-6 ",children:[(0,t.jsxs)("label",{htmlFor:"location-name",className:"block text-sm font-medium text-gray-700",children:["UploadImage",(0,t.jsx)("span",{className:"text-red-600 text-base",children:"*"})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("input",{type:"file",id:"u-heading-01",placeholder:"Location Name",title:" ",onChange:e=>Et(e.target.files[0]),autoComplete:"given-name",className:"mt-1  block w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm placeholder:text-gray-400 placeholder:!text-sm placeholder:font-medium focus:border-primary  focus:outline-none focus:ring-primary sm:text-sm"}),(0,t.jsx)("button",{className:`${I!==((z=($=r[0])==null?void 0:$.logo)==null?void 0:z.id)?"pointer-events-none bg-gray-400 ":""} ml-2 w-10 h-10 min-w-[40px] min-h-[40px] inline-flex float-right mt-2 items-center justify-center rounded-full border border-transparent bg-primary text-sm font-medium text-white shadow-sm hover:bg-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 sm:w-auto`,onClick:()=>I?Gt(Nt(I)):"",children:(0,t.jsx)("i",{className:"ri-download-2-line "})})]})]}),(0,t.jsxs)("div",{className:"col-span-6",children:[(0,t.jsx)("label",{htmlFor:"location-name",className:"block text-sm font-medium text-gray-700",children:"Location screen ids"}),(0,t.jsx)("textarea",{type:"text",name:"location-ids",id:"location-ids",placeholder:"Screen Ids",value:O||"",onChange:e=>Rt(e.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm placeholder:text-gray-400 placeholder:!text-sm placeholder:font-medium focus:border-primary  focus:outline-none focus:ring-primary sm:text-sm"})]})]})})})})]})})})}),Ot?(0,t.jsx)(St,{open:Mt,deleteHandle:Pt}):null,(0,t.jsx)(Lt.default,{isOpen:jt,onRequestClose:()=>Q(),style:Ft,ariaHideApp:!1,contentLabel:"Example Modal",children:(0,t.jsx)("div",{className:"",children:(0,t.jsxs)("div",{className:"",children:[" ",(0,t.jsx)("p",{className:"text-black",children:"Are you sure you have deleted the data for the stations you have deselected?"}),(0,t.jsxs)("div",{className:"flex-row flex mt-10 justify-center gap-5",children:[(0,t.jsxs)("button",{type:"button",className:"inline-flex font-semibold  justify-center  border border-transparent bg-red-100 px-4 py-2 text-sm text-red-600 shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:w-auto sm:text-sm",onClick:()=>Q(),children:["Cancel"," "]}),(0,t.jsxs)("button",{type:"button",onClick:()=>Tt(),className:"inline-flex  items-center justify-center h-[40px] text-[18px] rounded border bg-blue-500 border-blue-500 px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:["Ok"," "]})]})]})})}),(0,t.jsx)(kt,{})]})}export{qt as default,te as meta};
