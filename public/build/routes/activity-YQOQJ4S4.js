import{a as Me,b as me,c as de}from"/build/_shared/chunk-DAAR2UBC.js";import"/build/_shared/chunk-MZ7CGHKM.js";import{a as le}from"/build/_shared/chunk-YAUMQ47I.js";import"/build/_shared/chunk-OV4W7B6E.js";import{a as _e}from"/build/_shared/chunk-QPJOCY54.js";import{b as ae}from"/build/_shared/chunk-USL65MEA.js";import{d as ne}from"/build/_shared/chunk-RGLHNRFR.js";import"/build/_shared/chunk-7R5B3IJR.js";import"/build/_shared/chunk-VQXNYB6I.js";import{b as k}from"/build/_shared/chunk-YCQR2KKZ.js";import{B as re,c as se,h as S}from"/build/_shared/chunk-74WNBD7U.js";import{a as ce}from"/build/_shared/chunk-WA2IKA3N.js";import{a as u,b as I,d as K,g as y,h as G,i as O,l as Q}from"/build/_shared/chunk-SDPGU3B7.js";import{a as De}from"/build/_shared/chunk-46CN3765.js";import{j as oe}from"/build/_shared/chunk-62BE6IG2.js";import{a as q,b as J}from"/build/_shared/chunk-TYFUAS6F.js";import{d as f}from"/build/_shared/chunk-W6WK5VNR.js";var p=f(q());var ve=f(Me());var ue=f(_e());var Ce=f(De());var Y=f(q());var b=f(q());var d=f(J());function Le({data:t,date:i,locationId:X,refresh:D,setRefresh:A,head:h,isAdmin:R}){let[s,c]=(0,b.useState)(t!=null&&t.activity_name?t==null?void 0:t.activity_name:""),E="yyyy-MM-dd",[r,_]=(0,b.useState)(t!=null&&t.activity_description?t==null?void 0:t.activity_description:""),[w,j]=(0,b.useState)(t!=null&&t.time?t==null?void 0:t.time:""),[$,M]=(0,b.useState)(!1),[U,F]=(0,b.useState)(!1),T=async()=>{var v;!!(t!=null&&t.id)&&(t==null?void 0:t.id)?((s==null?void 0:s.trim())!==(t==null?void 0:t.activity_name)||w!==(t==null?void 0:t.time)||(r==null?void 0:r.trim())!==(t==null?void 0:t.activity_description))&&await S.items("activities").updateOne(t==null?void 0:t.id,{activity_name:s==null?void 0:s.trim(),activity_description:r==null?void 0:r.trim(),time:w}).then(L=>{A(!D)}).catch(L=>{console.log(L)}):(s==null?void 0:s.trim())&&w!==""&&await S.items("activities").createOne({date:y(i,E),activity_name:s==null?void 0:s.trim(),activity_description:r==null?void 0:r.trim(),time:w,location_id:X}).then(L=>{A(!D)}).catch(L=>{console.log(L)}),localStorage.setItem("ActivityWacthedWeek",((v=new Date(i))==null?void 0:v.getDay())==0?y(u(new Date(i),-2),"yyyy-MM-dd"):i)},P=async()=>{t!=null&&t.id&&(F(!0),await S.items("activities").deleteOne(t==null?void 0:t.id).then(v=>{k.success("Data deleted successfully")}).catch(v=>{console.log(v)}),location.reload(),A(!D),F(!1))},W=()=>{M(!1)};return b.default.useEffect(()=>{(s==null?void 0:s.length)>100&&c(s==null?void 0:s.substring(0,100)),(r==null?void 0:r.length)>100&&_(r==null?void 0:r.substring(0,100))},[s,r]),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("div",{className:"flex flex-col",onBlur:T,children:(0,d.jsxs)("div",{className:"flex border-b border-[#E1E1E1] relative z-[1]",children:[(0,d.jsxs)("div",{className:"min-w-[135px] px-2 py-[30px] relative z-[1] block text-center",children:[h&&(0,d.jsx)("span",{className:"inline-block uppercase p-2",children:"time"}),(0,d.jsx)("input",{type:"time",id:"activity-time",name:"activity",value:(w==null?void 0:w.slice(0,5))||"00:00",onChange:v=>{j(v.target.value)},className:" rounded-md  text-primary shadow-sm border border-primary focus:border-primary placeholder:font-bold placeholder:text-[#6E7878] placeholder:text-[14px] focus:outline-none focus:ring-1 focus:ring-primary sm:text-sm"})]}),(0,d.jsxs)("div",{className:"px-4 py-[30px] w-full",children:[h&&(0,d.jsx)("span",{className:"inline-block uppercase py-2 px-4",children:"Activity"}),(0,d.jsxs)("div",{className:"relative activity-title",children:[(0,d.jsx)("textarea",{type:"text",id:"activity-title",name:"activity",placeholder:"Enter the activity title",value:s||"",onChange:v=>{c(v.target.value)},className:"resize-none  min-h-[80px] w-full px-4 py-3 flex rounded-md justify-center items-center text-primary shadow-sm border border-primary focus:border-primary placeholder:font-bold placeholder:text-[#6E7878] placeholder:text-[14px] focus:outline-none focus:ring-1 focus:ring-primary sm:text-sm"}),(0,d.jsxs)("span",{className:"text-[10px] absolute bottom-0 right-2",children:[s==null?void 0:s.length,"/100"]})]}),(0,d.jsxs)("div",{className:"relative activity-description",children:[(0,d.jsx)("textarea",{type:"text",name:"description",id:"description",placeholder:"Enter the activity description",value:r||"",onChange:v=>_(v.target.value),className:"resize-none min-h-[80px] mt-4 block w-full rounded-md border border-primary py-2 px-3 shadow-sm placeholder:text-gray-400 placeholder:!text-sm placeholder:font-medium focus:border-primary  focus:outline-none focus:ring-primary sm:text-sm"}),(0,d.jsxs)("span",{className:"text-[10px] absolute bottom-0 right-2",children:[r==null?void 0:r.length,"/100"]})]}),R&&(0,d.jsx)("div",{className:`flex justify-end cursor-pointer absolute bottom-[5px] right-[15px] ${!!(t!=null&&t.id)&&(t==null?void 0:t.id)&&R?"":"hidden"}`,onClick:()=>M(!0),children:(0,d.jsx)("i",{className:"ri-delete-bin-line"})})]})]})}),$&&(0,d.jsx)(me,{modalIsOpen:$,setIsOpen:M,content:"Are you sure to delete data?",callFunction:P,cancelHandle:W,Loader:U})]})}var V=Le;var e=f(J());function Se(){return{title:"Activity Dashboard"}}function ye(){var Z,ee,te;let t=oe(),[i,X]=Y.default.useState(t),[D,A]=Y.default.useState(t==null?void 0:t.activityDetails),h=i==null?void 0:i.locationId,R="yyyy-MM-dd",s=S,[c,E]=(0,p.useState)(new Date),[r,_]=(0,p.useState)(O(c)),[w,j]=(0,p.useState)(new Date),[$,M]=(0,p.useState)(!1),[U,F]=(0,p.useState)(!0);(0,p.useEffect)(()=>{var a,m,g,x,B,H;let o=localStorage.getItem("ActivityWacthedWeek");if(localStorage.getItem("isUserExist")||(k.success("You are successfully logged in"),localStorage.setItem("isUserExist",!0)),o)try{E(new Date(o)),_(O(new Date(o))),j(new Date(o)),W({date:new Date(o)}),localStorage.removeItem("ActivityWacthedWeek")}catch(z){console.log(z)}let l=((a=i==null?void 0:i.currentUser)==null?void 0:a.selected_locations)!==null?(m=i==null?void 0:i.currentUser)==null?void 0:m.selected_locations:(g=i==null?void 0:i.currentUser)==null?void 0:g.allowed_locations[0].Locations_id;localStorage.setItem("admin",(x=i==null?void 0:i.currentUser)==null?void 0:x.is_admin),localStorage.setItem("activity",(B=i==null?void 0:i.currentUser)==null?void 0:B.activity),localStorage.setItem("selectedLocation",JSON.stringify(l)),localStorage.setItem("showDietary",JSON.stringify((H=i==null?void 0:i.currentUser)==null?void 0:H.show_dietary))},[U]);let T=(0,p.useRef)(),P=()=>{M(!0),setTimeout(()=>{M(!1)},2500)},W=async o=>{let n=y(I(o==null?void 0:o.date,{weekStartsOn:5}),R),l=y(I(u(o==null?void 0:o.date,7),{weekStartsOn:0}),R);await s.items("activities").readByQuery({fields:["*.*.*"],filter:{date:{_between:[n,l]},location_id:{_eq:h}},sort:["time","id"]}).then(a=>{A(a==null?void 0:a.data)}).catch(a=>console.log(a))},v=async o=>{P(),o==="prev"&&(await W({date:Q(c,1)}),E(Q(c,1)),_(O(Q(c,1)))),o==="next"&&(await W({date:K(c,1)}),E(K(c,1)),_(O(K(c,1))))},L=()=>{let o="EEEE",n=[],l=G(c)>4?c:u(c,4),a=I(l,{weekStartsOn:5});for(let m=0;m<3;m++)n.push((0,e.jsx)("div",{className:`col col-center  ${m!==6?"border-r":null} bordersky  border-[#C2C2C2] border-collapse p-2 min-w-[110px] table-head`,children:(0,e.jsx)("div",{className:"col col-center text-sm font-bold text-black",children:(0,e.jsxs)("div",{className:"flex justify-between flex-row px-1 align-middle day-options text-white relative",children:[(0,e.jsx)("div",{className:"day text-xs",children:y(u(a,m),o)}),(0,e.jsx)("div",{className:"text-white text-left font-normal",children:y(u(a,m),"dd/MM/yyyy")}),(0,e.jsx)("span",{className:"relative font-normal",children:(0,e.jsx)(de,{setRefresh:F,refresh:U,Id:m,startDate:u(a,m),locationId:h,type:"activity"},m)})]})})},m));return(0,e.jsx)("div",{className:"days row",children:n})},Ie=o=>{console.log("preview icon clicked"),k.warning("preview coming soon!")};var fe;let pe=o=>{var H;let n=G(c)>4?c:u(c,4),l=I(n,{weekStartsOn:5}),a=I(u(new Date(l),7),{weekStartsOn:0}),m=[],g=[],x=l,B="yyyy-MM-dd";for(fe=[];x<a;){for(let z=0;z<3;z++){let C=D==null?void 0:D.filter(N=>(N==null?void 0:N.date)===y(new Date(x),B));g.push((0,e.jsx)("div",{className:"dashboard relative col cell border-r border-[#C2C2C2] border-collapse text-primary",children:(0,e.jsxs)("div",{className:"day-column",children:[!!C&&(0,e.jsx)("div",{className:"day-activity",children:C==null?void 0:C.map((N,be)=>{var ie;return(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(V,{data:N,date:x,locationId:h,setRefresh:F,refresh:U,isAdmin:(ie=i==null?void 0:i.currentUser)==null?void 0:ie.is_admin,head:be==0})},N==null?void 0:N.id)})}),(0,e.jsx)(V,{data:"",date:x,locationId:h,setRefresh:F,refresh:U,head:(C==null?void 0:C.length)==0,isAdmin:(H=i==null?void 0:i.currentUser)==null?void 0:H.is_admin})]})},Math.random())),x=u(x,1)}m.push((0,e.jsx)("div",{className:"row activity",children:g},Math.random())),g=[]}return(0,e.jsx)("div",{className:"row1",children:m},Math.random())};function he(o){var n;(n=T.current)==null||n.dismiss()}async function we(o){var l,a;P();var n="";n=new Date(o.year,o.month-1,1),((l=new Date(o.year,o.month-1,1))==null?void 0:l.getDay())==0&&(n=new Date(o.year,o.month-1,2)),((a=new Date(o.year,o.month-1,1))==null?void 0:a.getDay())==6&&(n=new Date(o.year,o.month-1,3)),j(w),E(n),_(O(n)),await W({date:n})}let ge=()=>{var m,g;let o={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],from:"From",to:"To"};var n="dd";let l=I(c,{weekStartsOn:1},{days:7}),a=`${r==O(new Date)&&(c==null?void 0:c.getFullYear())==((m=new Date)==null?void 0:m.getFullYear())?"This week /":""} ${y(l,n)} th ${o.months[l.getMonth()]} - ${y(u(l,6),n)} th ${o.months[(g=u(l,6))==null?void 0:g.getMonth()]}`;return(0,e.jsxs)("div",{className:"activity",children:[(0,e.jsx)("div",{className:"header row justify-center ",children:(0,e.jsxs)("div",{className:"flex flex-col mobile-full",children:[(0,e.jsxs)("div",{className:"flex flex-row custom-date",children:[(0,e.jsxs)("div",{className:"mr-2",children:[o.months[c.getMonth()],","," ",c.getFullYear()]}),(0,e.jsx)("div",{className:"edit cursor-pointer",children:(0,e.jsx)(ve.default,{ref:T,years:{min:{year:new Date().getFullYear()-40},max:{year:new Date().getFullYear()+40}},value:{year:new Date().getFullYear(),month:new Date().getMonth()+1},lang:o.months,onChange:he,onDismiss:we,children:(0,e.jsx)("i",{onClick:()=>T.current.show(),className:"ri-edit-fill"})})})]}),(0,e.jsxs)("div",{className:"px-3 font-normal text-center text-base week",children:[(0,e.jsx)("span",{className:"font-medium",children:"Activities"})," / Week"," ",r]})]})}),(0,e.jsxs)("div",{className:"header row justify-between",children:[(0,e.jsx)("div",{className:"col",children:(0,e.jsxs)("div",{className:"icon cursor-pointer",onClick:()=>v("prev"),children:[(0,e.jsx)("i",{className:"ri-arrow-left-line ri-1x  "}),(0,e.jsx)("div",{className:"font-nunito font-medium",children:"Previous Week"})]})}),(0,e.jsx)("div",{children:"This week's activities"}),(0,e.jsx)("div",{className:"col col-end flex flex-col justify-between items-end",children:(0,e.jsxs)("div",{className:"icon cursor-pointer",onClick:()=>v("next"),children:[(0,e.jsx)("div",{className:"font-nunito font-medium",children:"Next Week"}),(0,e.jsx)("i",{className:"ri-arrow-right-line ri-1x ml-1 "})]})})]})]})},xe=async o=>{var l;await S.users.updateOne((l=i==null?void 0:i.currentUser)==null?void 0:l.id,{selected_locations:{id:o}}).then(a=>{k.success("Updated successfully"),M(!0),setTimeout(()=>{window.location.reload(!0)},1700)}).catch(a=>{k.error("Something went wrong")})},Ne=()=>{let o=document.getElementById("printContent").innerHTML,n=document.body.innerHTML;document.body.innerHTML=o,window.print(),document.body.innerHTML=n,window.location.reload()},ke=()=>{var o;(o=navigator==null?void 0:navigator.clipboard)==null||o.writeText(`${se}/banner/activities/${h}`),k.success("Link copied to clipboard!")};return(0,e.jsx)(Y.default.Fragment,{children:(Z=i==null?void 0:i.currentUser)!=null&&Z.activity?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ne,{title:!0,logout:!0,current:i==null?void 0:i.currentUser,location:i==null?void 0:i.currentUser,changeLocation:xe,noLeftLogo:!!((ee=re)!=null&&ee.includes(h))}),(0,e.jsx)("div",{className:"main-content-area",children:(0,e.jsx)("div",{className:"justify-center items-center px-5 py-4 lg:px-10 p-10 pt-12",children:(0,e.jsxs)("div",{className:"items-right ",children:[(0,e.jsx)("div",{className:"pb-7  items-center lg:px-1",children:ge()}),$?(0,e.jsx)(le,{}):(0,e.jsxs)(Y.default.Fragment,{children:[(0,e.jsx)("div",{className:"calendar rounded-md border-gray-500 ... border-collapse overflow-hidden",children:(0,e.jsxs)("div",{id:"printContent",children:[L(),pe()]})}),(0,e.jsx)("div",{className:"flex items-center justify-between print-copy",children:(0,e.jsxs)("div",{className:"row-content flex justify-start items-center my-5 flex-wrap gap-5 print-list",children:[(0,e.jsxs)("div",{className:"text-black font-medium text-xs inline-flex",children:[(0,e.jsxs)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",className:"css-i6dzq1",children:[(0,e.jsx)("polyline",{points:"6 9 6 2 18 2 18 9"}),(0,e.jsx)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),(0,e.jsx)("rect",{x:"6",y:"14",width:"12",height:"8"})]}),(0,e.jsx)("span",{className:"ml-2 cursor-pointer",onClick:()=>Ne(),children:"PRINT WEEKLY MENU"})]}),((te=i==null?void 0:i.currentUser)==null?void 0:te.is_admin)&&(0,e.jsxs)("div",{className:"text-black font-medium text-xs inline-flex",children:[(0,e.jsx)("i",{className:"ri-file-copy-line"}),(0,e.jsx)("span",{className:"ml-2 cursor-pointer",onClick:()=>ke(),children:"COPY LINK TO BANNER"})]})]})})]},Math.random())]})})}),(0,e.jsx)(ae,{})]}):(0,e.jsx)(ce,{})},Math.random())}export{ye as default,Se as meta};
