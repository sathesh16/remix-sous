{
  "version": 3,
  "sources": ["../../../../app/routes/signup/index.jsx"],
  "sourcesContent": ["import React from 'react'\nimport Input from '../../components/Input'\nimport Button from '../../components/Button'\nimport ImagesUpload from '../../components/ImagesUpload'\nimport { Form, useActionData } from '@remix-run/react'\nimport PasswordInput from '../../components/PasswordInput'\nimport { json } from '@remix-run/node'\n\n\nexport async function action({ request }) {\n  const contentType = request.headers.get(\"content-type\");\n  console.log(\"Received Content-Type:\", contentType);\n\n  if (!contentType || !contentType.includes(\"multipart/form-data\")) {\n    return json({ error: \"Bad content-type\", contentType }, { status: 400 });\n  }\n\n  const formData = await request.formData();\n\n  const first_name = formData.get(\"first-name\");\n  const last_name = formData.get(\"last-name\");\n  const email = formData.get(\"email\");\n  const password = formData.get(\"password\");\n  const confirmPassword = formData.get(\"confirm-password\");\n\n  if (password !== confirmPassword) {\n    return json({ error: \"Passwords do not match\" }, { status: 400 });\n  }\n\n  // \uD83D\uDD39 Step 1: Check if email already exists\n  const checkEmailRes = await fetch(\n    `http://192.168.1.51:8056/users?filter[email][_eq]=${encodeURIComponent(email)}`\n  );\n  const checkEmailJson = await checkEmailRes.json();\n\n  if (checkEmailJson?.data?.length > 0) {\n    return json({ error: \"Email already registered\" }, { status: 400 });\n  }\n\n  // \uD83D\uDD39 Step 2: Handle multiple file uploads\n  const images = formData.getAll(\"avatar\"); // multiple files from ImagesUpload\n  let uploadedImageIds = [];\n\n  for (const image of images) {\n    if (image && typeof image !== \"string\" && image.size > 0) {\n      const uploadData = new FormData();\n      uploadData.append(\"file\", image, image.name);\n\n      try {\n        const uploadRes = await fetch(\"http://192.168.1.51:8056/files\", {\n          method: \"POST\",\n          body: uploadData,\n        });\n\n        if (!uploadRes.ok) {\n          console.error(\"File upload failed:\", await uploadRes.text());\n          continue;\n        }\n\n        const uploadJson = await uploadRes.json();\n        if (uploadJson?.data?.id) uploadedImageIds.push(uploadJson.data.id);\n      } catch (error) {\n        console.error(\"Error uploading avatar:\", error);\n      }\n    }\n  }\n\n  // \uD83D\uDD39 Step 3: Create user (use the first uploaded image as avatar if any)\n  const avatarId = uploadedImageIds.length > 0 ? uploadedImageIds[0] : null;\n\n  const userRes = await fetch(\"http://192.168.1.51:8056/users\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({\n      first_name,\n      last_name,\n      email,\n      password,\n      avatar: avatarId,\n      status: \"active\",\n    }),\n  });\n\n  if (!userRes.ok) {\n    const err = await userRes.text();\n    return json({ error: err }, { status: 400 });\n  }\n\n  return redirect(\"/login\");\n}\n\n\nfunction SignUp() {\n\n    const actionData = useActionData()\n\n    return (\n\n        <div className=\"flex flex-col items-center justify-center min-h-screen gap-4 relative p-4\">\n\n            <div className=\"flex items-center justify-between w-full max-w-[400px]\">\n                SignUp\n                <img src=\"/images/iss_logo.webp\" width=\"50px\" />\n            </div>\n\n            {actionData?.error && (\n                <p className=\"text-red-500 text-sm\">{actionData.error}</p>\n            )}\n\n            {actionData?.success && (\n                <p className=\"text-red-500 text-sm\">okay</p>\n            )}\n\n            <Form method=\"post\" encType=\"multipart/form-data\" onSubmit={() => console.log(\"Form submitted\")} className=\"flex flex-col gap-6 max-w-[400px] w-full\">\n\n                <Input type='name' name=\"first-name\" required placeholder=\"Enter your first name\" />\n\n                <Input type='name' name=\"last-name\" required placeholder=\"Enter your last name\" />\n\n                <Input type=\"email\" required name=\"email\" placeholder=\"Email\" />\n\n                <div>Upload your image</div>\n\n                <Input type=\"file\" name=\"avatar\" required accept=\"image/*\" />\n\n                <PasswordInput placeholder=\"Enter password\" required name=\"password\" />\n\n                <PasswordInput placeholder=\"Confirm password\" required name=\"confirm-password\" />\n\n                <Button type=\"submit\">\n                    Sign up\n                </Button>\n\n            </Form>\n        </div>\n\n    )\n}\n\nexport default SignUp\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA,mBAAkB;AAsGF;AAVhB,SAAS,SAAS;AAEd,QAAM,aAAa,cAAc;AAEjC,SAEI,mDAAC,SAAI,WAAU,6EAEX;AAAA,uDAAC,SAAI,WAAU,0DAAyD;AAAA;AAAA,MAEpE,mDAAC,SAAI,KAAI,yBAAwB,OAAM,UAAvC;AAAA;AAAA;AAAA;AAAA,aAA8C;AAAA,SAFlD;AAAA;AAAA;AAAA;AAAA,WAGA;AAAA,IAEC,YAAY,SACT,mDAAC,OAAE,WAAU,wBAAwB,qBAAW,SAAhD;AAAA;AAAA;AAAA;AAAA,WAAsD;AAAA,IAGzD,YAAY,WACT,mDAAC,OAAE,WAAU,wBAAuB,oBAApC;AAAA;AAAA;AAAA;AAAA,WAAwC;AAAA,IAG5C,mDAAC,QAAK,QAAO,QAAO,SAAQ,uBAAsB,UAAU,MAAM,QAAQ,IAAI,gBAAgB,GAAG,WAAU,4CAEvG;AAAA,yDAAC,iBAAM,MAAK,QAAO,MAAK,cAAa,UAAQ,MAAC,aAAY,2BAA1D;AAAA;AAAA;AAAA;AAAA,aAAkF;AAAA,MAElF,mDAAC,iBAAM,MAAK,QAAO,MAAK,aAAY,UAAQ,MAAC,aAAY,0BAAzD;AAAA;AAAA;AAAA;AAAA,aAAgF;AAAA,MAEhF,mDAAC,iBAAM,MAAK,SAAQ,UAAQ,MAAC,MAAK,SAAQ,aAAY,WAAtD;AAAA;AAAA;AAAA;AAAA,aAA8D;AAAA,MAE9D,mDAAC,SAAI,iCAAL;AAAA;AAAA;AAAA;AAAA,aAAsB;AAAA,MAEtB,mDAAC,iBAAM,MAAK,QAAO,MAAK,UAAS,UAAQ,MAAC,QAAO,aAAjD;AAAA;AAAA;AAAA;AAAA,aAA2D;AAAA,MAE3D,mDAAC,yBAAc,aAAY,kBAAiB,UAAQ,MAAC,MAAK,cAA1D;AAAA;AAAA;AAAA;AAAA,aAAqE;AAAA,MAErE,mDAAC,yBAAc,aAAY,oBAAmB,UAAQ,MAAC,MAAK,sBAA5D;AAAA;AAAA;AAAA;AAAA,aAA+E;AAAA,MAE/E,mDAAC,UAAO,MAAK,UAAS,uBAAtB;AAAA;AAAA;AAAA;AAAA,aAEA;AAAA,SAlBJ;AAAA;AAAA;AAAA;AAAA,WAoBA;AAAA,OAnCJ;AAAA;AAAA;AAAA;AAAA,SAoCA;AAGR;AAEA,IAAO,iBAAQ;",
  "names": []
}
