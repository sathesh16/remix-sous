{
  "version": 3,
  "sources": ["empty-module:~/services/auth.server", "../../../app/routes/verification.jsx"],
  "sourcesContent": ["module.exports = {};", "import { json, redirect } from \"@remix-run/node\";\nimport { Form, Link, useActionData, useLoaderData } from \"@remix-run/react\";\nimport * as React from \"react\";\nimport HeaderFile from \"~/components/HeaderFile\";\nimport Footer from '~/components/Footer';\nimport { toast } from \"react-toastify\";\nimport authenticator from \"~/services/auth.server\";\nimport { sessionStorage,commitSession} from \"~/services/session.server\";\nimport { verifySessionStorage } from \"~/services/verifySession.server\";\nimport verifyAuthenticator from \"~/services/verify.server\";\nimport { getDirectusClient } from \"~/lib/directus\";\nexport const loader = async ({ request }) => {\n    await verifyAuthenticator.isAuthenticated(request, {\n        // successRedirect: \"/\",\n        failureRedirect: \"/login\",\n    });\n    const session = await sessionStorage.getSession(\n        request.headers.get(\"Cookie\")\n    );\n    var sessionKey=session.get(\"sessionKey\")\n    if(sessionKey?.token && sessionKey?.verifyId){\n        return redirect(\"/\")\n    }\n    return json({});\n};\n\nexport const action = async ({ request, context }) => {\n    // call my authenticator\n    const verifySession = await verifySessionStorage.getSession(\n        request.headers.get(\"Cookie\")\n    );\n    var sessionKey=verifySession.get(\"sessionKey\")\n    const directus = await getDirectusClient(sessionKey);\n    const current = await directus.users.me.read({ fields: [\"otp_value\"] });\n    const resp = await authenticator.authenticate(\"form\", request, {\n        // successRedirect: \"/\",\n        failureRedirect: \"/login\",\n        throwOnError: true,\n        context,\n    });\n    if(current?.otp_value ==resp?.verifyId){\n        const mergeSession={...sessionKey,...resp}\n\n        verifySession.set(authenticator.sessionKey, mergeSession);\n        let headers = new Headers({ \"Set-Cookie\": await sessionStorage.commitSession(verifySession) });\n        await directus.users.me.update({ otp_value:\"\"})\n    \n        return redirect(\"/\", { headers });\n\n    }else{\n        return json({error:\"Verification PIN is invalid!!!\"});\n    }\n   \n};\n\nexport function meta() {\n    return { title: \"Verification\" };\n}\nexport default function Verification() {\n    const loaderData = useLoaderData();\n    const actionData=useActionData();\n    const [pin, setPin] = React.useState(\"\");\n   const [buttonTrigger,setButtonTrigger]=React.useState(false)\n\n    React.useEffect(() => {\n         const element = document.getElementById(\"verifyId\");\n        element.addEventListener(\"click\", function() {\n            if(!buttonTrigger){\n                element.style.pointerEvents=\"none\";\n                setButtonTrigger(true)\n            }\n          });\n        if (actionData?.error) {\n                toast.error(actionData?.error,{\n                    onClose:()=>{element.style.pointerEvents=\"auto\";setButtonTrigger(false)}\n                });\n        }\n          return ()=>{\n            element.removeEventListener(\"click\", function() {\n                 setButtonTrigger(false);\n              })\n        }\n    }, [actionData]);\n \n    return (\n        <>\n            <HeaderFile login />\n            <div className=\"main-content-area\">\n                <div className=\"flex justify-center h-[calc(100vh-75px)] items-center px-5\">\n                    <Form\n                        className=\"max-w-[400px] w-full flex flex-col items-center text-[14px] \"\n                        method=\"post\"\n                    >\n                        <h1 className=\"text-center text-[24px] font-bold text-primary mb-12\">\n                            Verification\n                        </h1>\n                        <div className=\"mb-6 w-full\">\n                            <label\n                                htmlFor=\"u-mail-id1\"\n                                className=\"block text-sm font-bold text-primary\"\n                            >\n                                Verify OTP\n                            </label>\n                            <input\n                                type=\"tel\"\n                                id=\"u-mail-id1\"\n                                name=\"otp\"\n                                placeholder=\"enter your pin\"\n                                value={pin}\n                                onChange={(e) => setPin(e.target.value)}\n                                required\n                                className=\"mt-2 w-full px-4 py-3 flex justify-center items-center text-black shadow-sm border border-primary focus:border-primary placeholder:text-[#6E7878] placeholder:text-[14px] placeholder:font-normal focus:outline-none focus:ring-1 focus:ring-primary sm:text-sm\"\n                            />\n                        </div>\n                        <p\n                            className=\"self-end text-left font-normal text-green-600\"\n                        >\n                            *Please get in touch with the support team for the verification PIN.\n                        </p> \n                        <div className=\"mt-12 w-full\">\n                            <button\n                                type=\"submit\"\n                                id=\"verifyId\"\n                                className=\"inline-flex w-full items-center justify-center h-[50px] text-[18px] rounded border bg-primary border-primary px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2\"\n                            >\n                                \n                                {buttonTrigger?\"Verifing...\":\"Verify\"}\n                            </button>\n                        </div>\n                    </Form>\n                </div>\n            </div>\n            <Footer login/>\n        </>\n    );\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,WAAO,UAAU,CAAC;AAAA;AAAA;;;ACElB,YAAuB;AAIvB,kBAA0B;AAC1B,qBAA4C;AAC5C,2BAAqC;AACrC,oBAAgC;AAThC;AAuDO,SAAS,OAAO;AACnB,SAAO,EAAE,OAAO,eAAe;AACnC;AACe,SAAR,eAAgC;AACnC,QAAM,aAAa,cAAc;AACjC,QAAM,aAAW,cAAc;AAC/B,QAAM,CAAC,KAAK,MAAM,IAAU,eAAS,EAAE;AACxC,QAAM,CAAC,eAAc,gBAAgB,IAAQ,eAAS,KAAK;AAE1D,EAAM,gBAAU,MAAM;AACjB,UAAM,UAAU,SAAS,eAAe,UAAU;AACnD,YAAQ,iBAAiB,SAAS,WAAW;AACzC,UAAG,CAAC,eAAc;AACd,gBAAQ,MAAM,gBAAc;AAC5B,yBAAiB,IAAI;AAAA,MACzB;AAAA,IACF,CAAC;AACH,QAAI,yCAAY,OAAO;AACf,QAAM,MAAM,yCAAY,OAAM;AAAA,QAC1B,SAAQ,MAAI;AAAC,kBAAQ,MAAM,gBAAc;AAAO,2BAAiB,KAAK;AAAA,QAAC;AAAA,MAC3E,CAAC;AAAA,IACT;AACE,WAAO,MAAI;AACT,cAAQ,oBAAoB,SAAS,WAAW;AAC3C,yBAAiB,KAAK;AAAA,MACzB,CAAC;AAAA,IACP;AAAA,EACJ,GAAG,CAAC,UAAU,CAAC;AAEf,SACI;AAAA,IACI;AAAA,yDAAC;AAAA,QAAW,OAAK;AAAA,SAAjB;AAAA;AAAA;AAAA;AAAA,aAAkB;AAAA,MAClB,mDAAC;AAAA,QAAI,WAAU;AAAA,QACX,6DAAC;AAAA,UAAI,WAAU;AAAA,UACX,6DAAC;AAAA,YACG,WAAU;AAAA,YACV,QAAO;AAAA,YAEP;AAAA,iEAAC;AAAA,gBAAG,WAAU;AAAA,gBAAuD;AAAA,iBAArE;AAAA;AAAA;AAAA;AAAA,qBAEA;AAAA,cACA,mDAAC;AAAA,gBAAI,WAAU;AAAA,gBACX;AAAA,qEAAC;AAAA,oBACG,SAAQ;AAAA,oBACR,WAAU;AAAA,oBACb;AAAA,qBAHD;AAAA;AAAA;AAAA;AAAA,yBAKA;AAAA,kBACA,mDAAC;AAAA,oBACG,MAAK;AAAA,oBACL,IAAG;AAAA,oBACH,MAAK;AAAA,oBACL,aAAY;AAAA,oBACZ,OAAO;AAAA,oBACP,UAAU,CAAC,MAAM,OAAO,EAAE,OAAO,KAAK;AAAA,oBACtC,UAAQ;AAAA,oBACR,WAAU;AAAA,qBARd;AAAA;AAAA;AAAA;AAAA,yBASA;AAAA;AAAA,iBAhBJ;AAAA;AAAA;AAAA;AAAA,qBAiBA;AAAA,cACA,mDAAC;AAAA,gBACG,WAAU;AAAA,gBACb;AAAA,iBAFD;AAAA;AAAA;AAAA;AAAA,qBAIA;AAAA,cACA,mDAAC;AAAA,gBAAI,WAAU;AAAA,gBACX,6DAAC;AAAA,kBACG,MAAK;AAAA,kBACL,IAAG;AAAA,kBACH,WAAU;AAAA,kBAGT,0BAAc,gBAAc;AAAA,mBANjC;AAAA;AAAA;AAAA;AAAA,uBAOA;AAAA,iBARJ;AAAA;AAAA;AAAA;AAAA,qBASA;AAAA;AAAA,aAvCJ;AAAA;AAAA;AAAA;AAAA,iBAwCA;AAAA,WAzCJ;AAAA;AAAA;AAAA;AAAA,eA0CA;AAAA,SA3CJ;AAAA;AAAA;AAAA;AAAA,aA4CA;AAAA,MACA,mDAAC;AAAA,QAAO,OAAK;AAAA,SAAb;AAAA;AAAA;AAAA;AAAA,aAAa;AAAA;AAAA,KA/CjB;AAAA;AAAA;AAAA;AAAA,SAgDA;AAER;",
  "names": []
}
