{
  "version": 3,
  "sources": ["../../../node_modules/@glideapps/glide-data-grid/src/internal/data-grid-overlay-editor/data-grid-overlay-editor.tsx", "../../../node_modules/@glideapps/glide-data-grid/dist/esm/internal/data-grid-overlay-editor/data-grid-overlay-editor-style.js", "../../../node_modules/@glideapps/glide-data-grid/src/internal/data-grid-overlay-editor/use-stay-on-screen.ts"],
  "sourcesContent": ["import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport ClickOutsideContainer from \"../click-outside-container/click-outside-container.js\";\nimport { makeCSSStyle, type Theme, ThemeContext } from \"../../common/styles.js\";\nimport type { GetCellRendererCallback } from \"../../cells/cell-types.js\";\nimport {\n    type EditableGridCell,\n    type GridCell,\n    isEditableGridCell,\n    isInnerOnlyCell,\n    isObjectEditorCallbackResult,\n    type Item,\n    type ProvideEditorCallback,\n    type ProvideEditorCallbackResult,\n    type Rectangle,\n    type ValidatedGridCell,\n} from \"../data-grid/data-grid-types.js\";\nimport { DataGridOverlayEditorStyle } from \"./data-grid-overlay-editor-style.js\";\nimport type { OverlayImageEditorProps } from \"./private/image-overlay-editor.js\";\nimport { useStayOnScreen } from \"./use-stay-on-screen.js\";\n\ntype ImageEditorType = React.ComponentType<OverlayImageEditorProps>;\n\ninterface DataGridOverlayEditorProps {\n    readonly target: Rectangle;\n    readonly cell: Item;\n    readonly content: GridCell;\n    readonly className?: string;\n    readonly id: string;\n    readonly initialValue?: string;\n    readonly bloom?: readonly [number, number];\n    readonly theme: Theme;\n    readonly onFinishEditing: (newCell: GridCell | undefined, movement: readonly [-1 | 0 | 1, -1 | 0 | 1]) => void;\n    readonly forceEditMode: boolean;\n    readonly highlight: boolean;\n    readonly imageEditorOverride?: ImageEditorType;\n    readonly getCellRenderer: GetCellRendererCallback;\n    readonly markdownDivCreateNode?: (content: string) => DocumentFragment;\n    readonly provideEditor?: ProvideEditorCallback<GridCell>;\n    readonly validateCell?: (\n        cell: Item,\n        newValue: EditableGridCell,\n        prevValue: GridCell\n    ) => boolean | ValidatedGridCell;\n    readonly isOutsideClick?: (e: MouseEvent | TouchEvent) => boolean;\n}\n\nconst DataGridOverlayEditor: React.FunctionComponent<DataGridOverlayEditorProps> = p => {\n    const {\n        target,\n        content,\n        onFinishEditing: onFinishEditingIn,\n        forceEditMode,\n        initialValue,\n        imageEditorOverride,\n        markdownDivCreateNode,\n        highlight,\n        className,\n        theme,\n        id,\n        cell,\n        bloom,\n        validateCell,\n        getCellRenderer,\n        provideEditor,\n        isOutsideClick,\n    } = p;\n\n    const [tempValue, setTempValueRaw] = React.useState<GridCell | undefined>(forceEditMode ? content : undefined);\n    const lastValueRef = React.useRef(tempValue ?? content);\n    lastValueRef.current = tempValue ?? content;\n\n    const [isValid, setIsValid] = React.useState(() => {\n        if (validateCell === undefined) return true;\n        return !(isEditableGridCell(content) && validateCell?.(cell, content, lastValueRef.current) === false);\n    });\n\n    const onFinishEditing = React.useCallback<typeof onFinishEditingIn>(\n        (newCell, movement) => {\n            onFinishEditingIn(isValid ? newCell : undefined, movement);\n        },\n        [isValid, onFinishEditingIn]\n    );\n\n    const setTempValue = React.useCallback(\n        (newVal: GridCell | undefined) => {\n            if (validateCell !== undefined && newVal !== undefined && isEditableGridCell(newVal)) {\n                const validResult = validateCell(cell, newVal, lastValueRef.current);\n                if (validResult === false) {\n                    setIsValid(false);\n                } else if (typeof validResult === \"object\") {\n                    newVal = validResult;\n                    setIsValid(true);\n                } else {\n                    setIsValid(true);\n                }\n            }\n            setTempValueRaw(newVal);\n        },\n        [cell, validateCell]\n    );\n\n    const finished = React.useRef(false);\n    const customMotion = React.useRef<[-1 | 0 | 1, -1 | 0 | 1] | undefined>(undefined);\n\n    const onClickOutside = React.useCallback(() => {\n        onFinishEditing(tempValue, [0, 0]);\n        finished.current = true;\n    }, [tempValue, onFinishEditing]);\n\n    const onEditorFinished = React.useCallback(\n        (newValue: GridCell | undefined, movement?: readonly [-1 | 0 | 1, -1 | 0 | 1]) => {\n            onFinishEditing(newValue, movement ?? customMotion.current ?? [0, 0]);\n            finished.current = true;\n        },\n        [onFinishEditing]\n    );\n\n    const onKeyDown = React.useCallback(\n        async (event: React.KeyboardEvent) => {\n            let save = false;\n            if (event.key === \"Escape\") {\n                event.stopPropagation();\n                event.preventDefault();\n                customMotion.current = [0, 0];\n            } else if (event.key === \"Enter\" && !event.shiftKey) {\n                event.stopPropagation();\n                event.preventDefault();\n                customMotion.current = [0, 1];\n                save = true;\n            } else if (event.key === \"Tab\") {\n                event.stopPropagation();\n                event.preventDefault();\n                customMotion.current = [event.shiftKey ? -1 : 1, 0];\n                save = true;\n            }\n\n            window.setTimeout(() => {\n                if (!finished.current && customMotion.current !== undefined) {\n                    onFinishEditing(save ? tempValue : undefined, customMotion.current);\n                    finished.current = true;\n                }\n            }, 0);\n        },\n        [onFinishEditing, tempValue]\n    );\n\n    const targetValue = tempValue ?? content;\n\n    const [editorProvider, useLabel] = React.useMemo((): [ProvideEditorCallbackResult<GridCell>, boolean] | [] => {\n        if (isInnerOnlyCell(content)) return [];\n        const external = provideEditor?.(content);\n        if (external !== undefined) return [external, false];\n        return [getCellRenderer(content)?.provideEditor?.(content), false];\n    }, [content, getCellRenderer, provideEditor]);\n\n    const { ref, style: stayOnScreenStyle } = useStayOnScreen();\n\n    let pad = true;\n    let editor: React.ReactNode;\n    let style = true;\n    let styleOverride: React.CSSProperties | undefined;\n\n    if (editorProvider !== undefined) {\n        pad = editorProvider.disablePadding !== true;\n        style = editorProvider.disableStyling !== true;\n        const isObjectEditor = isObjectEditorCallbackResult(editorProvider);\n        if (isObjectEditor) {\n            styleOverride = editorProvider.styleOverride;\n        }\n        const CustomEditor = isObjectEditor ? editorProvider.editor : editorProvider;\n        editor = (\n            <CustomEditor\n                isHighlighted={highlight}\n                onChange={setTempValue}\n                value={targetValue}\n                initialValue={initialValue}\n                onFinishedEditing={onEditorFinished}\n                validatedSelection={isEditableGridCell(targetValue) ? targetValue.selectionRange : undefined}\n                forceEditMode={forceEditMode}\n                target={target}\n                imageEditorOverride={imageEditorOverride}\n                markdownDivCreateNode={markdownDivCreateNode}\n                isValid={isValid}\n                theme={theme}\n            />\n        );\n    }\n\n    styleOverride = { ...styleOverride, ...stayOnScreenStyle };\n\n    // Consider imperatively creating and adding the element to the dom?\n    const portalElement = document.getElementById(\"portal\");\n    if (portalElement === null) {\n        // eslint-disable-next-line no-console\n        console.error(\n            'Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id=\"portal\" />` as the last child of your `<body>`.'\n        );\n        return null;\n    }\n\n    let classWrap = style ? \"gdg-style\" : \"gdg-unstyle\";\n    if (!isValid) {\n        classWrap += \" gdg-invalid\";\n    }\n\n    if (pad) {\n        classWrap += \" gdg-pad\";\n    }\n\n    const bloomX = bloom?.[0] ?? 1;\n    const bloomY = bloom?.[1] ?? 1;\n\n    return createPortal(\n        <ThemeContext.Provider value={theme}>\n            <ClickOutsideContainer\n                style={makeCSSStyle(theme)}\n                className={className}\n                onClickOutside={onClickOutside}\n                isOutsideClick={isOutsideClick}>\n                <DataGridOverlayEditorStyle\n                    ref={ref}\n                    id={id}\n                    className={classWrap}\n                    style={styleOverride}\n                    as={useLabel === true ? \"label\" : undefined}\n                    targetX={target.x - bloomX}\n                    targetY={target.y - bloomY}\n                    targetWidth={target.width + bloomX * 2}\n                    targetHeight={target.height + bloomY * 2}>\n                    <div className=\"gdg-clip-region\" onKeyDown={onKeyDown}>\n                        {editor}\n                    </div>\n                </DataGridOverlayEditorStyle>\n            </ClickOutsideContainer>\n        </ThemeContext.Provider>,\n        portalElement\n    );\n};\n\nexport default DataGridOverlayEditor;\n", "import { styled } from \"@linaria/react\";\nconst _exp2 = /*#__PURE__*/() => p => p.targetX;\nconst _exp3 = /*#__PURE__*/() => p => p.targetY;\nconst _exp4 = /*#__PURE__*/() => p => p.targetWidth;\nconst _exp5 = /*#__PURE__*/() => p => p.targetHeight;\nconst _exp6 = /*#__PURE__*/() => p => p.targetY + 10;\nconst _exp7 = /*#__PURE__*/() => p => Math.max(0, (p.targetHeight - 28) / 2);\nexport const DataGridOverlayEditorStyle = /*#__PURE__*/styled('div')({\n  name: \"DataGridOverlayEditorStyle\",\n  class: \"gdg-d19meir1\",\n  propsAsIs: false,\n  vars: {\n    \"d19meir1-0\": [_exp3(), \"px\"],\n    \"d19meir1-1\": [_exp2(), \"px\"],\n    \"d19meir1-2\": [_exp4(), \"px\"],\n    \"d19meir1-3\": [_exp5(), \"px\"],\n    \"d19meir1-4\": [_exp6(), \"px\"],\n    \"d19meir1-5\": [_exp7(), \"px\"]\n  }\n});\n\n", "import * as React from \"react\";\n\nfunction useRefState(): [HTMLElement | undefined, React.RefCallback<HTMLElement | null>] {\n    const [refState, setRefState] = React.useState<HTMLElement | null>();\n    return [refState ?? undefined, setRefState];\n}\n\ninterface StayOnScreen {\n    ref: React.RefCallback<HTMLElement | null>;\n    style: React.CSSProperties;\n}\n\nexport function useStayOnScreen(): StayOnScreen {\n    const [ref, setRef] = useRefState();\n    const [xOffset, setXOffset] = React.useState(0);\n    const [isIntersecting, setIsIntersecting] = React.useState(true);\n\n    React.useLayoutEffect(() => {\n        if (ref === undefined) return;\n        if (!(\"IntersectionObserver\" in window)) return;\n\n        const observer = new IntersectionObserver(\n            ents => {\n                if (ents.length === 0) return;\n                setIsIntersecting(ents[0].isIntersecting);\n            },\n            { threshold: 1 }\n        );\n        observer.observe(ref);\n\n        return () => observer.disconnect();\n    }, [ref]);\n\n    React.useEffect(() => {\n        if (isIntersecting || ref === undefined) return;\n\n        let rafHandle: number | undefined;\n        const fn = () => {\n            const { right: refRight } = ref.getBoundingClientRect();\n\n            setXOffset(cv => Math.min(cv + window.innerWidth - refRight - 10, 0));\n            rafHandle = requestAnimationFrame(fn);\n        };\n\n        rafHandle = requestAnimationFrame(fn);\n        return () => {\n            if (rafHandle !== undefined) {\n                cancelAnimationFrame(rafHandle);\n            }\n        };\n    }, [ref, isIntersecting]);\n\n    const style = React.useMemo(() => {\n        return { transform: `translateX(${xOffset}px)` };\n    }, [xOffset]);\n\n    return {\n        ref: setRef,\n        style,\n    };\n}\n"],
  "mappings": "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",
  "names": ["React"]
}
